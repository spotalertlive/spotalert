<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SpotAlert</title>
  <link rel="stylesheet" href="/styles.css" />

  <!-- OneSignal SDK (v16) -->
  <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
  <script>
    // Init OneSignal using the App ID from our safe /api/public-keys endpoint
    window.OneSignalDeferred = window.OneSignalDeferred || [];
    fetch('/api/public-keys')
      .then(r => r.json())
      .then(cfg => {
        window.OneSignalDeferred.push(async function (OneSignal) {
          await OneSignal.init({ appId: cfg.oneSignalAppId });
          // (Optional) immediately show permission prompt on first visit:
          // await OneSignal.Notifications.requestPermission();
        });
      })
      .catch(err => console.error('Failed to load public keys:', err));
  </script>

  <!-- hls.js for HLS CCTV playback (optional) -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</head>
<body class="sa-body">
  <header class="sa-nav">
    <a href="/" class="sa-brand">
      <img src="/assets.logo.svg" alt="SpotAlert" height="28" />
    </a>
    <nav>
      <a href="#features">Features</a>
      <a href="#camera">Camera</a>
      <a href="#about">About</a>
      <a href="#contact">Contact</a>
    </nav>
  </header>

  <section class="hero">
    <div class="hero-card">
      <h1>Stay aware.<br/>Report fast.</h1>
      <p>AI‑powered real‑time surveillance &amp; security alerts — anytime, anywhere.</p>
      <div class="hero-actions">
        <button id="openCameraBtn" class="btn-primary">Open Camera Demo</button>
        <button id="enableAlertsBtn" class="btn-secondary">Enable Alerts</button>
      </div>
    </div>
  </section>

  <section id="features" class="section">
    <h2>Our Features (Ready Now)</h2>
    <ul class="bullets">
      <li>AI‑based real‑time incident detection (browser demo)</li>
      <li>CCTV &amp; camera system integration (edge‑ready scaffolding)</li>
      <li>Instant email &amp; web push alerts (SMS optional)</li>
      <li>Secure cloud storage for evidence (S3)</li>
      <li>Analytics dashboard for threat patterns (coming module)</li>
    </ul>
    <div class="note-pill">Shira Assistant can triage via email replies.</div>
  </section>

  <section id="camera" class="section">
    <h2>Live Camera (Demo)</h2>
    <p>This MVP runs 100% in your browser. Nothing is uploaded unless you capture a frame.</p>

    <div class="camera-wrap">
      <video id="liveVideo" autoplay playsinline muted></video>
      <canvas id="captureCanvas" width="1280" height="720" hidden></canvas>
      <div class="controls">
        <button id="startCameraBtn" class="btn-primary">Start Camera</button>
        <button id="captureFrameBtn" class="btn-dark" disabled>Capture Frame</button>
        <button id="stopCameraBtn" class="btn-danger" disabled>Stop Camera</button>
      </div>
      <div id="cameraStatus" class="status">Camera idle.</div>
    </div>
  </section>

  <section id="about" class="section">
    <h2>About SpotAlert</h2>
    <p>SpotAlert is your trusted AI security partner, designed to detect, alert, and
       respond to threats faster than any human system. Whether for home, business,
       or public safety, SpotAlert ensures 24/7 monitoring with advanced AI capabilities.</p>
  </section>

  <section id="contact" class="section">
    <h2>Contact Us</h2>
    <p>Email support only — Shira can triage and reply.</p>
    <a href="mailto:support@spotalert.live" class="email-pill">support@spotalert.live</a>
  </section>

  <footer class="footer">© 2025 SpotAlert. All rights reserved.</footer>

  <!-- Wire up the Enable Alerts button -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const btn = document.getElementById('enableAlertsBtn');
      if (!btn) return;

      btn.addEventListener('click', async () => {
        try {
          // Ask for permission & subscribe
          const granted = await OneSignal.Notifications.requestPermission();
          if (!granted) {
            alert('Please allow notifications to receive SpotAlert alerts.');
            return;
          }
          const userId = await OneSignal.User.getId();
          console.log('Subscribed. OneSignal User ID:', userId);
          alert('Alerts enabled! You are subscribed.');
        } catch (e) {
          console.error('Enable Alerts error:', e);
          alert('Could not enable alerts. Check console for details.');
        }
      });
    });
  </script>

  <script src="/app.js"></script>
</body>
</html>
